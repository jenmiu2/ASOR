# Practica 1.4: Protocolo IPv6

# Objetivos
En esta práctica se estudian los aspectos básicos del protocolo IPv6, el manejo de los diferentes tipos de direcciones y mecanismos de configuración. Además se analizarán las características más importantes del protocolo ICMP versión 6.

# Preparación del entorno para la práctica

```c
netprefix inet
machine 1 0 0
machine 2 0 0
machine 3 0 0 1 1
machine 4 0 1
```

# Direcciones de enlace local
Una dirección de enlace local es únicamente válida en la subred que está definida. Ningún encaminador dará salida a un datagrama con una dirección de enlace local como destino. El prefijo de formato para estas direcciones es fe80::/10.

### Ejercicio 1[VM1, VM2]
Activar el interfaz eth0 en VM1 y VM2. Comprobar las direcciones de enlace local que tienen asignadas con el comando ip.
### Ejercicio 2[VM1, VM2]
Comprobar la conectividad entre VM1 y VM2 con la orden ping6. Cuando se usan direcciones de enlace local, y  **sólo en ese caso**, es necesario especificar el interfaz origen, añadiendo %<nombre_interfaz> a la dirección. Consultar las opciones del comando ping6 en la página de manual. Observar el tráfico generado con la herramienta wireshark, especialmente los protocolos encapsulados en cada datagrama y los parámetros del protocolo IPv6.
### Ejercicio 3[Router, VM4]
Activar el interfaz de VM4 y los dos interfaces de Router. Comprobar la conectividad entre Router y VM1, y entre Router y VM4 usando la dirección de enlace local.
# Direcciones ULA
Una dirección ULA (_Unique Local Address_) puede usarse dentro de una organización, de forma que los encaminadores internos del sitio deben encaminar los datagramas con una dirección ULA como destino. El prefijo de formato para estas direcciones es fc00::/7.
### Ejercicio 4[VM1, VM2]
Configurar VM1 y VM2 para que tengan una dirección ULA en la red fd00:0:0:a::/64 con el comando ip. La parte de identificador de interfaz puede elegirse libremente, siempre que no coincida para ambas máquinas.  **Nota:** Incluir la longitud del prefijo al fijar las direcciones.
### Ejercicio 5[VM1, VM2]
Comprobar la conectividad entre VM1 y VM2 con la orden ping6 usando la nueva dirección. Observar los mensajes intercambiados con wireshark.
### Ejercicio 6[Router, VM4]
Configurar direcciones ULA en los dos interfaces de Router (redes fd00:0:0:a::/64 y fd00:0:0:b::/64) y en el de VM4 (red fd00:0:0:b::/64). Elegir el identificador de interfaz de forma que no coincida dentro de la misma red.
### Ejercicio 7[Router]
Comprobar la conectividad entre Router y VM1, y entre Router y VM4 usando direcciones ULA. Comprobar además que VM1 no puede alcanzar a VM4.
# Encaminamiento estático
Según la topología que hemos configurado en esta práctica, Router debe encaminar el tráfico entre las redes fd00:0:0:a::/64 y fd00:0:0:b::/64. En esta sección vamos a configurar un encaminamiento estático basado en las rutas que fijaremos manualmente en todas las máquinas.

### Ejercicio 8[Router, VM1]
Consultar las tablas de rutas en VM1 y Router con el comando ip route. Consultar la página de manual del comando para seleccionar las rutas IPv6
### Ejercicio 9[Router]
Para que Router actúe efectivamente como encaminador, hay que activar el reenvío de paquetes (_packet forwarding_). De forma temporal, se puede activar con el comando ```sysctl -w net.ipv6.conf.all.forwarding=1```.
### Ejercicio 10[Router, VM4, VM1, VM2]
Finalmente, hay que configurar la tabla de rutas en las máquinas virtuales. Añadir la dirección correspondiente de Router como ruta por defecto con el comando ip route. Comprobar la conectividad entre VM1 y VM4 usando el comando ping6.
### Ejercicio 11[Router, VM4, VM1]
Borrar la  _cache_  de vecinos en VM1 con ip neigh flush dev eth0 y en Router con ip neigh flush dev eth1. Con ayuda de la herramienta wireshark, completar la siguiente tabla al usar la orden ping6 entre VM1 y VM4 con todos los mensajes hasta el primer ICMP Echo Reply:

#### Red fd00:0:0:a::/64 - VM1
|  MAC Origen| MAC Destino | IPv6 Origen | IPv6 Destino | ICMPv6 Tipo
|--|--|--|--|--|--|
|  |  |  |  |  |
|  |  |  |  |  |

#### Red fd00:0:0:b::/64 - VM4
|  MAC Origen| MAC Destino | IPv6 Origen | IPv6 Destino | ICMPv6 Tipo
|--|--|--|--|--|--|
|  |  |  |  |  |
|  |  |  |  |  |
# Configuración persistente
### Ejercicio 12
### Ejercicio 13
# Autoconfiguración. Anuncio de prefijos
### Ejercicio 14
### Ejercicio 15
### Ejercicio 16
### Ejercicio 17
### Ejercicio 18
# ICMPv6
### Ejercicio 19
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTM5MDU5NTI0Ml19
-->