# Practica 1.3: Domain Name System (DNS)

# Objetivos
En esta práctica, emplearemos herramientas cliente DNS para explorar la estructura del servicio en Internet. Después, configuraremos un servicio de nombres basado en BIND. El objetivo es estudiar tanto los pasos básicos de configuración del servicio como la base de datos y funcionamiento del protocolo.

# Cliente DNS
Usaremos las herramientas clientes DNS, que serán de utilidad tanto para depurar el despliegue del servicio DNS en nuestra red local, como para estudiar la estructura de DNS en Internet. Las herramientas principales para consultar un servicio DNS son dig y host. Para esta primera parte,  **se usará la máquina física**  del puesto del laboratorio. Si las consultas DNS a determinados servidores estuvieran bloqueadas,  **se usará un interfaz web**como  [www.digwebinterface.com](http://www.digwebinterface.com/)  (activando las opciones “Stats” y “Show command”) o  [www.diggui.com](http://www.diggui.com/).

### Ejercicio 1
El archivo de configuración del cliente DNS es /etc/resolv.conf. Consultar la página de manual de resolv.conf y estudiar el significado de las opciones nameserver y search. Ver el contenido del archivo en la máquina física del laboratorio.

### Ejercicio 2 
Partiendo únicamente del servidor raíz a.root-servers.net y de las respuestas obtenidas de cada servidor obtener la dirección IP de  [informatica.ucm.es](http://informatica.ucm.es/). Determinar el TTL de cada registro y completar la siguiente tabla:
| Servidor | Nombre | TTL | Tipo | Datos | 
|--|--|--|--|--|
|  |  |  |  |  |  |

**NOTA:** Usar el comando dig @<servidor> <nombre> <tipo>. Más información en la página de manual de dig.

### Ejercicio 3 
Obtener el registro SOA de ucm.es. usando un servidor autoritativo de la zona. Identificar los campos relevantes del registro.

### Ejercicio 4
Determinar qué servidor debería usarse para enviar un mail a  [webmaster@fdi.ucm.es](mailto:webmaster@fdi.ucm.es).

### Ejercicio 5[Router, VM4]
Repetir la configuración de red para el segmento 192.168.0.0/24. Comprobar la conectividad entre Router y VM4; y entre Router, VM1 y VM2.

# Encaminamiento estático

Según la topología de esta práctica la máquina Router puede encaminar el tráfico entre las redes 10.0.0.0/24 y 192.168.0.0/24. En esta sección, vamos a configurar el encaminamiento estático, basado en rutas que fijaremos manualmente en todas las máquinas virtuales.
### Ejercicio 6[Router]
Activar el reenvío de paquetes (_forwarding_) en Router para que efectivamente pueda funcionar como encaminador entre las redes 10.0.0.0/24 y 192.168.0.0/24. Ejecutar el siguiente comando:
### Ejercicio 7[VM1, VM4]
Añadir la máquina Router como encaminador por defecto para VM1 y VM2. Usar el comando ip route.
### Ejercicio 8[VM4]
Aunque la configuración adecuada para la tabla de rutas de hosts en redes como las consideradas en esta práctica consiste en añadir una ruta por defecto, es posible incluir rutas para redes concretas. Añadir a la tabla de rutas de VM4 una ruta a la red 10.0.0.0/24 via Router.

### Ejercicio 9[VM1, VM4]
Usar la orden ping entre las máquinas VM1 y VM4. Con ayuda de la herramienta wireshark completar la siguiente tabla para todos los paquetes intercambiados hasta la recepción de la primera respuesta Echo Reply.

#### Red 10.0.0.0/24 - VM1
| MAC Origen | MAC Desitno | Protocolo | IP Origen | IP Destino | Tipo Mensaje |
|--|--|--|--|--|--|--|--|
|  |  |  |  |  |  |  |  | 

#### Red 192.168.0.0/24 - VM4
| MAC Origen | MAC Desitno | Protocolo | IP Origen | IP Destino | Tipo Mensaje |
|--|--|--|--|--|--|--|--|
|  |  |  |  |  |  |  |  | 

# Configuración dinámica de hosts
El protocolo DHCP permite configurar dinámicamente los parámetros de red un host. En esta sección configuraremos Router como servidor DHCP para las dos redes. Aunque DHCP puede incluir muchos parámetros de configuración, en esta práctica sólo fijaremos el encaminador por defecto.

### Ejercicio 10[VM1, VM2, VM4]
Eliminar las direcciones IP de los interfaces (ip addr del).
### Ejercicio 11[Router]
Configurar el servidor DHCP para las dos redes:
- Editar el fichero /etc/dhcp/dhcpd.conf y añadir dos secciones subnet para cada red que definan los rangos de direcciones_,_ 10.0.0.50 - 10.0.0.100 y 192.168.0.50 - 192.168.0.100, respectivamente. Además, incluir la opción routers con la IP de Router en cada red.
- Arrancar el servicio con el comando ``` service dhcpd start ```
### Ejercicio 12[Router, VM4]
Iniciar la captura de paquetes en Router. Arrancar el cliente DHCP ``` dhclient -d eth0 ``` en la máquina virtual VM1 y observar el proceso de configuración. Completar la siguiente tabla:

| IP Origen | IP Destino | Mensaje DHCP | Opciones DHCP |
|--|--|--|--|
|  |  |  |  |
### Ejercicio 13 [VM4]
Durante el arranque del sistema se pueden configurar automáticamente determinados interfaces según la información almacenada en el disco del servidor. Consultar el fichero /etc/sysconfig/network-scripts/ifcfg-eth0 de VM4, que configura automáticamente eth0 usando DHCP. Para más información, consultar el fichero /usr/share/doc/initscripts-*/sysconfig.txt.
### Ejercicio 14 [VM4]
Comprobar la configuración automática con las órdenes ifup e ifdown. Verificar la conectividad entre todas las máquinas de las dos redes.

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTY3NTMxMTkwNV19
-->