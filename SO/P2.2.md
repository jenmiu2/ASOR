
# Practica 2.2: Sistema de Ficheros

# Objetivos
En esta práctica se revisan las funciones del sistema básicas para manejar un sistema de ficheros, referentes a la creación de ficheros y directorios, duplicación de descriptores, obtención de información de ficheros o el uso de cerrojos.

# Creación y atributos de ficheros
El i-nodo de un fichero guarda diferentes atributos de éste, como por ejemplo el propietario, permisos de acceso, tamaño o los tiempos de acceso, modificación y creación. En esta sección veremos las llamadas al sistema más importantes para consultar y fijar estos atributos así como las herramientas del sistema para su gestión.

### Ejercicio 1

La herramienta principal para consultar el contenido y atributos básicos de un fichero es ls. Consultar la página de manual y estudiar el uso de las opciones -a -l -d -h -i -R -1 -F y --color. Estudiar el significado de la salida en cada caso.

### Ejercicio 2 
El  _modo_  de un fichero es <tipo><rwx_propietario><rwx_grupo><rwx_resto>:

- tipo: - fichero ordinario; d directorio; l enlace; c dispositivo carácter; b dispositivo bloque; p FIFO; s socket

- rwx: r lectura (4); w escritura (2); x ejecución (1)

Comprobar los permisos de algunos directorios (con ls -ld).

### Ejercicio 3

Los permisos se pueden otorgar de forma selectiva usando la notación octal o la simbólica. Ejemplo, probar las siguientes órdenes (equivalentes):

- chmod 540 fichero

- chmod u+rx,g+r-wx,o-wxr fichero

¿Cómo se podrían fijar los permisos rw-r--r-x, de las dos formas?


### Ejercicio 4
Crear un directorio y quitar los permisos de ejecución para usuario, grupo y otros. Intentar cambiar al directorio.

### Ejercicio 5
Escribir un programa que, usando la llamada open(2), cree un fichero con los permisos rw-r--r-x. Comprobar el resultado y las características del fichero con la orden ls.

### Ejercicio 6
Cuando se crea un fichero, los permisos por defecto se derivan de la máscara de usuario (_umask_). El comando interno de la  _shell_ umask permite consultar y fijar esta máscara. Usando este comando, fijar la máscara de forma que los nuevos ficheros no tengan permiso de escritura para el grupo y ningún permiso para otros. Comprobar el funcionamiento con los comandos touch, mkdir y ls.

### Ejercicio 7
Modificar el ejercicio 5 para que, antes de crear el fichero, se fije la máscara igual que en el ejercicio 6. Comprobar el resultado con el comando ls. Comprobar que la máscara del proceso padre (la  _shell_) no cambia.
### Ejercicio 8
El comando id(1) muestra la información de usuario real y efectiva. Consultar la página de manual y comprobar su funcionamiento.

### Ejercicio 9
Escribir un programa que muestre, igual que id, el UID real y efectivo del usuario. ¿Cuándo podríamos asegurar que el fichero del programa tiene activado el bit  *setuid*?

### Ejercicio 10
Modificar el programa anterior para que muestre además el nombre de usuario, el  directorio  *home*  y la descripción del usuario.

# Información horaria del sistema

### Ejercicio 11

El comando *date(1)* muestra la hora del sistema. Consultar la página de manual y familiarizarse con los distintos formatos disponibles para mostrar la hora.

### Ejercicio 12
Escribir un programa que muestre la hora, en segundos desde el Epoch, usando la función *time(2)*.

### Ejercicio 13 
Escribir un programa que mida, en microsegundos usando la función *gettimeofday(2)*, lo que tarda un bucle que incrementa una variable un millón de veces.
### Ejercicio 14
Escribir un programa que muestre el año usando la función *localtime(3)*.
### Ejercicio 15
Modificar el programa anterior para que imprima la hora de forma legible, como "lunes, 29 de octubre de 2018, 10:34", usando la función *strftime(3)*.

**Nota:**  Para establecer la configuración regional (_locale_, como idioma o formato de hora) en el programa según la configuración actual, usar la función *setlocale(3)*, por ejemplo, *setlocale(LC_ALL, "")*. Para cambiar la configuración regional, ejecutar, por ejemplo, export LC_ALL="es_ES", o bien, export LC_TIME="es_ES".**_Nota:_**  Para establecer la configuración regional (_locale_, como idioma o formato de hora) en el programa según la configuración actual, usar la función setlocale(3), por ejemplo, setlocale(LC_ALL, ""). Para cambiar la configuración regional, ejecutar, por ejemplo, export LC_ALL="es_ES", o bien, export LC_TIME="es_ES".
<!--stackedit_data:
eyJoaXN0b3J5IjpbOTA5ODcxNzFdfQ==
-->